
<!DOCTYPE html>
<html><head>
    
    
    <title> CIGMAH - Mood Diary </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="">
    <meta name="theme-color" content="#000000" />
    <link rel="icon" href="https://cigmah.org/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cigmah.org/js/toggles.js"></script>
    <link type="text/css" rel="stylesheet" href=https://cigmah.org/sass/main.css>
    <link rel="canonical" href="https://cigmah.org/events/2019_text_processing/tute-01-mood-diary/mood-diary/">
</head>
<body>
        <header>

            <nav id="nav-menu-toggle" onClick="toggleNav()">
                <div id="menu-text">â˜°</div>
                <div id="cigmah-brand">
                    <div id="cigmah-icon">
                        <img src="https://cigmah.org/img/cigmah-icon.png">
                    </div>
                    <div id="cigmah-text">
                        CIGMAH
                    </div>
                </div>
            </nav>

            <nav id="nav-bar">

<ul id="nav-link-list" onClick="()">

    <li
        class="nav-link-list-item "
    >
        <a
            class="nav-link-list-link "
            id="nav-cigmah-link"
            href=https://cigmah.org/
        >
            <img id="nav-cigmah-link-icon" src="/img/cigmah-icon-small.png">
            <div>CIGMAH</div>
        </a>
    </li>

  
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/about/
        >
            About
        </a>
    </li>
    
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/events/
        >
            Events
        </a>
    </li>
    
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/tools/
        >
            Tools
        </a>
    </li>
    
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/resources/
        >
            Resources
        </a>
    </li>
    
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/blog/
        >
            Blog
        </a>
    </li>
    
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/contact/
        >
            Contact
        </a>
    </li>
    

    <li
        class="nav-link-list-item"
        id="nav-right-item"
        >
        <a
            href="https://apps.cigmah.org"
            id="nav-aorta-link"
            class="nav-link-list-link"
        >
            <div id="nav-aorta-link">Web Apps</div>
        </a>
    </li>
</ul>
</nav>

        </header>

        <main>



<section class="normal-page">
    <article id="side-navigation">
        <article id="toggle-side-navigation-container">

            
            <a href="https://cigmah.org/events/2019_text_processing/tute-01-transfusion-tracing/transfusion-tracing/" id="back"> &lt;&lt; </a>
            

            <button id="toggle-side-navigation" onClick="toggleSideNav()">Show Articles</button>

            
            <a href="https://cigmah.org/events/2019_text_processing/tute-01-mapping-meningitis/mapping-meningitis/" id="next"> &gt;&gt; </a>
            

        </article>

        <ul id="side-navigation-list">

            
            <li class="side-navigation-parent">
                <a href="https://cigmah.org/events/">Events</a>
            </li>
            


            <li class="side-navigation-section">
                <a href="https://cigmah.org/events/2019_text_processing/">
                    Night 1: Text Processing
                </a>
            </li>

            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_text_processing/tute-01-contraindicated/contraindicated/">Contraindicated</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_text_processing/tute-01-mapping-meningitis/mapping-meningitis/">Mapping Meningitis</a>
            </li>
            
            <li
                class="side-navigation-item  active "
            >
                <a href="https://cigmah.org/events/2019_text_processing/tute-01-mood-diary/mood-diary/">Mood Diary</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_text_processing/tute-01-transfusion-tracing/transfusion-tracing/">Transfusion Tracing</a>
            </li>
            

        </ul>

    </article>

    <section id="container">

        <article id="content">
            <header id="content-header">
            <h1 id="content-title"> Mood Diary </h1>

            
                <div id="subtitle">
                    <div>  </div>
                </div>
            

            </div>

            </header>

            <section id="content-body">
                
<h2 id="headline-1">
Problem
</h2>
<p>
Kennedy, a 26 year old male, has been struggling with depression. On your
advice, he has started tracking and reflecting on his mood every day for the
past two years from 1st January 2020 to 31st December 2021 inclusive.
</p>
<p>
To track his mood, he used a (fictional) mobile app - Mood Diary. Every day,
Mood Diary would send him a push notification asking him to select one of five
moods. Each mood corresponds to one of five mood levels, and is drawn randomly
from a descriptor pool for that level. Here are the descriptors Mood Diary uses:
</p>
<table>
<thead>
<tr>
<th class="align-right">Mood Level</th>
<th>Descriptors</th>
</tr>
</thead>
<tbody>
<tr>
<td class="align-right">1</td>
<td>Depressed, very low, hopeless, bleak</td>
</tr>
<tr>
<td class="align-right">2</td>
<td>Low, sad, teary, flat, tired, stressed</td>
</tr>
<tr>
<td class="align-right">3</td>
<td>So-so, okay, fine, not bad, satisfied</td>
</tr>
<tr>
<td class="align-right">4</td>
<td>Good, refreshed, happy, joyful</td>
</tr>
<tr>
<td class="align-right">5</td>
<td>On top of the world, ecstatic, elated, elevated, amazing, brilliant, fantastic</td>
</tr>
</tbody>
</table>
<p>
For example, on a given day, Mood Diary might present the five words
&#34;Depressed&#34;, &#34;Tired&#34;, &#34;Fine&#34;, &#34;Refreshed&#34; and &#34;Amazing&#34;. Kennedy then selects
one of those five moods for that day.
</p>
<p>
Kennedy has exported his mood results and would like you to help him interpret
them. The exported data consists of one line per day - a date, four spaces, then
a sentence which Mood Diary uses to represent each day (&#34;I feel {MOOD} today.&#34;).
The mood is as described in the table above, but in capital letters.
</p>
<div class="src src-text">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">2020/01/01    I feel SAD today.</code></pre></div>
</div>
<p>
<strong>Your task</strong> is to:
</p>
<ol>
<li>
<p>
Process Kennedy&#39;s exported Mood Diary text and classify each day into a mood
level.
</p>
</li>
<li>
<p>
Plot Kennedy&#39;s mood level over the 2 years.
</p>
</li>
<li>
<p>
Identify approximately when (to the nearest month) Kennedy&#39;s mood level
pattern changed.
</p>
</li>
</ol>
<p>
<a href="../input-mood-diary.txt">Click here to download your text input. (26KB, .txt).</a>
</p>
<h2 id="headline-2">
Solution
</h2>
<details><summary>Click to show the answer.</summary>
<p>
Kennedy&#39;s mood level changed, to the nearest month, in <strong>April 2021</strong>.
</p>
</details>
<details><summary>Click to show the solution.</summary>
<p>
First, we need to read the file data into a variable so we can refer to it in
Python. We&#39;ll read the file into a string with the <code class="verbatim">read()</code> method. Reading and
writing files is something you&#39;ll have to do very often, so it&#39;s good to get
familiar with this.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">FILEPATH <span style="color:#666">=</span> <span style="color:#ba2121">&#34;./input-mood-diary.txt&#34;</span> <span style="color:#408080;font-style:italic"># Set variable FILEPATH to the file location</span>

<span style="color:#008000;font-weight:bold">with</span> <span style="color:#008000">open</span>(FILEPATH) <span style="color:#008000;font-weight:bold">as</span> infile:      <span style="color:#408080;font-style:italic"># Open the file and put its handle into variable infile</span>
    RAW <span style="color:#666">=</span> infile<span style="color:#666">.</span>read()             <span style="color:#408080;font-style:italic"># Call read() on the handle to read the contents</span></code></pre></div>
</div>
<p>
The variable <code class="verbatim">RAW</code> now contains a big <a href="https://en.wikipedia.org/wiki/String_(computer_science)">string</a> of the entire file contents. Let&#39;s
read the first 40 characters.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">print</span>(RAW[:<span style="color:#666">40</span>])</code></pre></div>
</div>
<pre class="example">
2020/01/01    I feel SAD today.
2020/01/
</pre>
<p>
Let&#39;s try and extract just the date, and the word between &#34;feel&#34; and &#34;today&#34;
from each line in <code class="verbatim">RAW</code>. A very useful tool to do this with is <a href="https://en.wikipedia.org/wiki/Regular_expression">regular
expressions</a>. Regular expressions (regexs) are a very compact way to define how
to extract certain elements from a piece of text with a well-defined structure.
</p>
<p>
For each line in the file, we notice that it&#39;s formatted like so:
</p>
<div class="src src-text">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">YYYY/MM/DD    I feel MOOD today.</code></pre></div>
</div>
<p>
We can write a regular expression that will match this as the following:
</p>
<div class="src src-text">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">(.*)\s{4}I feel (.*) today.</code></pre></div>
</div>
<p>
This might look a bit confusing if you&#39;re not familiar with regular expressions.
The first part, <code class="verbatim">.*</code>, will match any character (<code class="verbatim">.</code>) zero or more times (<code class="verbatim">*</code>).
This will match the date as a whole (we&#39;ll split it up later). The second part,
<code class="verbatim">\s{4}</code>, will match any whitespace character (<code class="verbatim">\s</code>) (e.g. spaces!) exactly 4
times. The third part, <code class="verbatim">I feel (.*) today.</code> will match the phrase &#34;I feel MOOD
today.&#34;, where <code class="verbatim">MOOD</code> can any character (<code class="verbatim">.</code>) occuring zero or more times (<code class="verbatim">*</code>).
We choose to match any character rather than say just letters, because we know
that some of the moods have spaces or a hyphen in them. Finally, anything
enclosed in brackets will actually be extracted from the string.
</p>
<p>
In Python, we can compile and use regular expressions with the <code class="verbatim">re</code> library,
which is part of Python&#39;s standard set of modules. We will use the <code class="verbatim">findall()</code>
method to find every line which matches the regular expression we&#39;ve defined and
extracts the date and mood from each line.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">re</span>                                      <span style="color:#408080;font-style:italic"># Import re library</span>

MATCH_RE <span style="color:#666">=</span> <span style="color:#ba2121">r</span><span style="color:#ba2121">&#39;(.*)\s{4}I feel (.*) today.&#39;</span>      <span style="color:#408080;font-style:italic"># Define the regex</span>
MATCHER <span style="color:#666">=</span> re<span style="color:#666">.</span>compile(MATCH_RE)                 <span style="color:#408080;font-style:italic"># &#34;Compile&#34; the regex</span>

SPLIT <span style="color:#666">=</span> MATCHER<span style="color:#666">.</span>findall(RAW)                   <span style="color:#408080;font-style:italic"># Apply matcher to all lines</span></code></pre></div>
</div>
<p>
Let&#39;s look at the first item of the list <code class="verbatim">SPLIT</code>, which contains all our
extracted data.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">print</span>(SPLIT[<span style="color:#666">0</span>])</code></pre></div>
</div>
<pre class="example">
(&#39;2020/01/01&#39;, &#39;SAD&#39;)
</pre>
<p>
This is a <a href="https://docs.python.org/3/tutorial/datastructures.html#tuples-and-sequences">tuple</a> which contains two elements, both of which are strings. The list
<code class="verbatim">SPLIT</code> contains a list of these tuples.
</p>
<p>
Now that we&#39;ve split the file contents into a list of the strings we&#39;re
interested, let&#39;s now try to convert each of them to something numerical we can
plot.
</p>
<p>
Let&#39;s first try and create a list containing a <code class="verbatim">datetime</code> object for each of the
first items in the list <code class="verbatim">SPLIT</code>, which is a more &#34;date and time&#34;-aware version
of the string-form of the date.
</p>
<p>
Python&#39;s standard library comes with a <a href="https://docs.python.org/3.7/library/datetime.html">datetime library</a> which handles a large
variety of datetime operations. As we want to parse a datetime string into a
datetime object, we&#39;ll use the <code class="verbatim">strptime()</code> (think &#34;string parse time&#34;) method.
</p>
<p>
To parse the string into a datetime, we need to define the datetime
specification. <a href="https://docs.python.org/3.7/library/datetime.html#strftime-and-strptime-behavior">The documentation</a> provides a good explanation of how to define
this specification. The format of datestrings in this data is particularly
common, and we&#39;ll specify it as <code class="verbatim">%Y/%m/%d</code> - i.e. a 4-digit year (<code class="verbatim">%Y</code>), a
forward slash, a 2-digit month (<code class="verbatim">%m</code>), a forward slash, then a 2-digit day
(<code class="verbatim">%d</code>). Many more flexible specifications are possible though!
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">datetime</span> <span style="color:#008000;font-weight:bold">import</span> datetime

DATETIMES <span style="color:#666">=</span> [datetime<span style="color:#666">.</span>strptime(string[<span style="color:#666">0</span>], <span style="color:#ba2121">&#39;%Y/%m/</span><span style="color:#b68;font-weight:bold">%d</span><span style="color:#ba2121">&#39;</span>) <span style="color:#008000;font-weight:bold">for</span> string <span style="color:#a2f;font-weight:bold">in</span> SPLIT]</code></pre></div>
</div>
<p>
Datetime is a bit of an unusual module in that the module is called <code class="verbatim">datetime</code>,
which contains a class also called <code class="verbatim">datetime</code>. Don&#39;t worry too much about it for
now.
</p>
<p>
The last line is called a <a href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions">list comprehension</a>. List comprehensions are
<em>extremely</em> useful in Python and let you define operations on the entirety of a
list in a very concise manner. In this example, we take the first element of
each list item (in Python and many other programming languages, the first item
corresponds to the index at 0, the second at 1 etc.) (<code class="verbatim">string[0]</code>), and we parse
it with the specification we&#39;ve described using <code class="verbatim">strptime</code>, and we do so for
every item in the SPLIT list (<code class="verbatim">for string in SPLIT</code>). We then store all those
datetimes in the <code class="verbatim">DATETIMES</code> variable.
</p>
<p>
Here&#39;s the first item of DATETIMES.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">print</span>(DATETIMES[<span style="color:#666">0</span>]<span style="color:#666">.</span>)</code></pre></div>
</div>
<pre class="example">
datetime.datetime(2020, 1, 1, 0, 0)
</pre>
<p>
We can see it&#39;s been parsed into a <code class="verbatim">datetime</code> object with actual numbers.
</p>
<p>
We now want to translate each of the mood level words into a level. We can do
this with a <a href="https://docs.python.org/3/tutorial/datastructures.html#dictionaries">dictionary</a> in Python, which you can think of as just like a
dictionary in real-life - something that tells us how to map one item to
another. In other languages, these are sometimes called <a href="https://en.wikipedia.org/wiki/Hash_table">hash maps</a> or hash
tables. In this case, we want to map each mood word into a mood level.
</p>
<p>
We&#39;ll define it explicitly below. This isn&#39;t the most elegant way, but it is
certainly the most obvious way and a quick way to get introduced to
dictionaries! We&#39;ll basically translate the table verbatim.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">MOOD_DICT <span style="color:#666">=</span> {
    <span style="color:#ba2121">&#34;DEPRESSED&#34;</span>: <span style="color:#666">1</span>,
    <span style="color:#ba2121">&#34;VERY LOW&#34;</span>: <span style="color:#666">1</span>,
    <span style="color:#ba2121">&#34;HOPELESS&#34;</span>: <span style="color:#666">1</span>,
    <span style="color:#ba2121">&#34;BLEAK&#34;</span>: <span style="color:#666">1</span>,
    <span style="color:#ba2121">&#34;LOW&#34;</span>: <span style="color:#666">2</span>,
    <span style="color:#ba2121">&#34;SAD&#34;</span>: <span style="color:#666">2</span>,
    <span style="color:#ba2121">&#34;TEARY&#34;</span>: <span style="color:#666">2</span>,
    <span style="color:#ba2121">&#34;FLAT&#34;</span>: <span style="color:#666">2</span>,
    <span style="color:#ba2121">&#34;TIRED&#34;</span>: <span style="color:#666">2</span>,
    <span style="color:#ba2121">&#34;STRESSED&#34;</span>: <span style="color:#666">2</span>,
    <span style="color:#ba2121">&#34;SO-SO&#34;</span>: <span style="color:#666">3</span>,
    <span style="color:#ba2121">&#34;OKAY&#34;</span>: <span style="color:#666">3</span>,
    <span style="color:#ba2121">&#34;FINE&#34;</span>: <span style="color:#666">3</span>,
    <span style="color:#ba2121">&#34;NOT BAD&#34;</span>: <span style="color:#666">3</span>,
    <span style="color:#ba2121">&#34;SATISFIED&#34;</span>: <span style="color:#666">3</span>,
    <span style="color:#ba2121">&#34;GOOD&#34;</span>: <span style="color:#666">4</span>,
    <span style="color:#ba2121">&#34;REFRESHED&#34;</span>: <span style="color:#666">4</span>,
    <span style="color:#ba2121">&#34;HAPPY&#34;</span>: <span style="color:#666">4</span>,
    <span style="color:#ba2121">&#34;JOYFUL&#34;</span>: <span style="color:#666">4</span>,
    <span style="color:#ba2121">&#34;ON TOP OF THE WORLD&#34;</span>: <span style="color:#666">5</span>,
    <span style="color:#ba2121">&#34;ECSTATIC&#34;</span>: <span style="color:#666">5</span>,
    <span style="color:#ba2121">&#34;ELATED&#34;</span>: <span style="color:#666">5</span>,
    <span style="color:#ba2121">&#34;ELEVATED&#34;</span>: <span style="color:#666">5</span>,
    <span style="color:#ba2121">&#34;AMAZING&#34;</span>: <span style="color:#666">5</span>,
    <span style="color:#ba2121">&#34;BRILLIANT&#34;</span>: <span style="color:#666">5</span>,
    <span style="color:#ba2121">&#34;FANTASTIC&#34;</span>: <span style="color:#666">5</span>,
}</code></pre></div>
</div>
<blockquote>
<p>
As an alternative, you could parse the table into this dictionary rather than
writing it out by hand, which would save you typing it out and avoid
transcription errors. This would be the preferable option but, for now, don&#39;t
worry too much about it.
</p>
</blockquote>
<p>
We can now write a list comprehension to translate each of the mood descriptors
into their corresponding number.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">MOOD_LEVELS <span style="color:#666">=</span> [MOOD_DICT[string[<span style="color:#666">1</span>]] <span style="color:#008000;font-weight:bold">for</span> string <span style="color:#a2f;font-weight:bold">in</span> SPLIT]</code></pre></div>
</div>
<p>
Let&#39;s now see the first 5 items of <code class="verbatim">MOOD_LEVELS</code>.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">print</span>(MOOD_LEVELS[:<span style="color:#666">5</span>])</code></pre></div>
</div>
<pre class="example">
[2, 1, 3, 1, 2]
</pre>
<p>
We now have all the datetimes and the mood levels in numerical (or number-aware)
formats. We can now plot the data.
</p>
<p>
One of the most often-used libraries for plotting in Python is <a href="https://matplotlib.org/">matplotlib</a>.
Matplotlib is very powerful and used for all sorts of different types of plots.
Python doesn&#39;t come with <code class="verbatim">matplotlib</code> by default - if you&#39;re using vanilla
Python, you&#39;ll have to install it with <code class="verbatim">pip</code>. If you&#39;re using the Anaconda
distribution, you should already have it available.
</p>
<p>
To plot with matplotlib, the easiest interface is through <code class="verbatim">pyplot</code>, which makes
plotting as easy as calling a single function. It is convention to import
<code class="verbatim">pyplot</code> as a shorter name, <code class="verbatim">plt</code>. Let&#39;s first try a very naive scatter plot -
because this is discrete data with only 5 levels, it won&#39;t look very nice, so
we&#39;ll plot another representation after.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#408080;font-style:italic"># Don&#39;t worry about these two lines - these are for us making the tutorial!</span>
<span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">matplotlib</span>
matplotlib<span style="color:#666">.</span>use(<span style="color:#ba2121">&#39;Agg&#39;</span>)

<span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">matplotlib</span> <span style="color:#008000;font-weight:bold">import</span> pyplot <span style="color:#008000;font-weight:bold">as</span> plt</code></pre></div>
</div>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig <span style="color:#666">=</span> plt<span style="color:#666">.</span>figure()

xs <span style="color:#666">=</span> [d<span style="color:#666">.</span>toordinal() <span style="color:#008000;font-weight:bold">for</span> d <span style="color:#a2f;font-weight:bold">in</span> DATETIMES]                         <span style="color:#408080;font-style:italic"># Convert datetimes to numbers</span>
xticks <span style="color:#666">=</span> [datetime<span style="color:#666">.</span>strftime(d, <span style="color:#ba2121">&#39;%Y/%m/</span><span style="color:#b68;font-weight:bold">%d</span><span style="color:#ba2121">&#39;</span>) <span style="color:#008000;font-weight:bold">for</span> d <span style="color:#a2f;font-weight:bold">in</span> DATETIMES]  <span style="color:#408080;font-style:italic"># Convert datetimes to strings</span>

plt<span style="color:#666">.</span>scatter(             <span style="color:#408080;font-style:italic"># Call the scatterplot function</span>
    x<span style="color:#666">=</span>xs,                <span style="color:#408080;font-style:italic"># With the ordinal dates as x values</span>
    y<span style="color:#666">=</span>MOOD_LEVELS,       <span style="color:#408080;font-style:italic"># And the mood levels as y values</span>
)
plt<span style="color:#666">.</span>xticks(xs[::<span style="color:#666">56</span>], xticks[::<span style="color:#666">56</span>], rotation<span style="color:#666">=</span><span style="color:#666">90</span>)    <span style="color:#408080;font-style:italic"># Set the x ticks to every 56th date</span>
plt<span style="color:#666">.</span>yticks(<span style="color:#008000">range</span>(<span style="color:#666">1</span>,<span style="color:#666">6</span>), <span style="color:#008000">range</span>(<span style="color:#666">1</span>,<span style="color:#666">6</span>))                 <span style="color:#408080;font-style:italic"># Set the y ticks to 1-5 (range excludes last val)</span>
plt<span style="color:#666">.</span>title(<span style="color:#ba2121">&#39;Scatter Plot of Mood Levels over Time&#39;</span>) <span style="color:#408080;font-style:italic"># Set the title</span>
plt<span style="color:#666">.</span>ylabel(<span style="color:#ba2121">&#39;Mood Level&#39;</span>)                           <span style="color:#408080;font-style:italic"># Set the y axis label</span>
plt<span style="color:#666">.</span>xlabel(<span style="color:#ba2121">&#39;Date&#39;</span>)                                 <span style="color:#408080;font-style:italic"># Set the x axis label</span>
plt<span style="color:#666">.</span>tight_layout()                                 <span style="color:#408080;font-style:italic"># Squeeze the layout</span></code></pre></div>
</div>
<pre class="example">
Text(0.5, -42.22777777777778, &#39;Date&#39;)
</pre>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#408080;font-style:italic"># Save the figure - don&#39;t worry about this part, this is for our use!</span>
PLOT_FILENAME <span style="color:#666">=</span> <span style="color:#ba2121">&#34;mood-diary-plot.png&#34;</span>
plt<span style="color:#666">.</span>savefig(PLOT_FILENAME)
PLOT_FILENAME</code></pre></div>
</div>
<p>
<img src="../mood-diary-plot.png" alt="../mood-diary-plot.png" title="../mood-diary-plot.png" />
</p>
<p>
Although the plot itself isn&#39;t a very good choice of representing the data, we
can see a clear shift roughly aroud April 2021 in Kennedy&#39;s mood. There&#39;s a lot
going on in the plot code if you haven&#39;t used <code class="verbatim">matplotlib</code> before - but it makes
scripting plots very easy, and very easily modifiable. The plotting interface is
very well documented, so that would be our recommendation if you have trouble as
a first port of call (or, Google! Many people have used matplotlib before and
will have likely encountered the same problems as you have).
</p>
<p>
Can we represent this data in a nicer graphical format? There are some
interesting ways we can plot categorical, ordinal data over a time series. We&#39;ll
choose a very simple way - a rolling average with a width of 28 days. We can
already see a trend, but given that the data only has 5 levels, the trend would
probably be easier to visualise with smoothing. We can also see there appears to
be cyclical changes in mood given that it appears to go up and down a lot,
though the period of this cycle appears to be quite short.
</p>
<p>
<a href="https://pandas.pydata.org/">Pandas</a> is a data analysis library for Python and one that tends to get a lot of
praise in the data science community as one of Python&#39;s premier strengths.
Pandas makes a lot of basic data analysis operations very simple by abstracting
them out into callable functions. Pandas can also encapsulate data into a
spreadsheet-like data structure, known as <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">Data Frames</a>. Data Frames are a bit
like a transparent, (more-easily) programmable Excel document.
</p>
<p>
Again, if you are using vanilla Python, you&#39;ll need to install <code class="verbatim">Pandas</code> through
<code class="verbatim">pip</code>. If you are using Anaconda, it should already be included.
</p>
<p>
Let&#39;s import Pandas and load the data into a dataframe. By convention, pandas is
often imported in to Python under a shorter name, <code class="verbatim">pd</code>.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">pandas</span> <span style="color:#008000;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">pd</span>

DATAFRAME <span style="color:#666">=</span> pd<span style="color:#666">.</span>DataFrame(                  <span style="color:#408080;font-style:italic"># Create a dataframe</span>
    <span style="color:#008000">zip</span>(DATETIMES, MOOD_LEVELS),           <span style="color:#408080;font-style:italic"># With the data</span>
    columns<span style="color:#666">=</span>[<span style="color:#ba2121">&#39;datetimes&#39;</span>, <span style="color:#ba2121">&#39;mood_levels&#39;</span>],  <span style="color:#408080;font-style:italic"># With these column names</span>
)
DATAFRAME<span style="color:#666">.</span>set_index(<span style="color:#ba2121">&#39;datetimes&#39;</span>, inplace<span style="color:#666">=</span>True) <span style="color:#408080;font-style:italic"># Set the index to datetime column</span></code></pre></div>
</div>
<p>
Pandas will convert a list of lists into a 2D spreadsheet-like DataFrame - we
use <code class="verbatim">zip</code> here to &#34;zip&#34; the two lists <code class="verbatim">DATETIMES</code> and <code class="verbatim">MOOD_LEVELS</code> into a list
of lists. Here&#39;s the first 3 rows of <code class="verbatim">DATAFRAME</code>:
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DATAFRAME[:<span style="color:#666">3</span>]</code></pre></div>
</div>
<pre class="example">
            mood_levels
datetimes
2020-01-01            2
2020-01-02            1
2020-01-03            3
</pre>
<p>
Pandas already implements a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rolling.html">rolling</a> function to do rolling window calculations,
which we can apply to calculate a rolling average.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ROLLED <span style="color:#666">=</span> DATAFRAME<span style="color:#666">.</span>rolling(  <span style="color:#408080;font-style:italic"># Perform a rolling window calculation</span>
    window<span style="color:#666">=</span><span style="color:#666">28</span>,               <span style="color:#408080;font-style:italic"># With a window size of 28 (days)</span>
    center<span style="color:#666">=</span>True,             <span style="color:#408080;font-style:italic"># Centered at each day</span>
)<span style="color:#666">.</span>mean()                     <span style="color:#408080;font-style:italic"># And take the mean of each window</span></code></pre></div>
</div>
<p>
Let&#39;s look at the results at the 14th to 17th index. The first 14 values will be
<code class="verbatim">NaN</code> because the a window of width 28 can only start fitting into the data at
the 14th index.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ROLLED[<span style="color:#666">14</span>:<span style="color:#666">17</span>]</code></pre></div>
</div>
<pre class="example">
            mood_levels
datetimes
2020-01-15     2.607143
2020-01-16     2.571429
2020-01-17     2.607143
</pre>
<p>
Each of these values now represents the average mood level of in the 14 days
prior to and 14 days after the listed date.
</p>
<p>
Pandas exposes a very convenient <a href="https://pandas.pydata.org/pandas-docs/version/0.22/generated/pandas.DataFrame.plot.html">plot method on Data Frames</a> which means you can
plot the Data Frame directly. Let&#39;s use it.
</p>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig <span style="color:#666">=</span> plt<span style="color:#666">.</span>figure() <span style="color:#408080;font-style:italic"># Create a new figure</span>

ax <span style="color:#666">=</span> ROLLED<span style="color:#666">.</span>plot(  <span style="color:#408080;font-style:italic"># Plot the dataframe</span>
    kind<span style="color:#666">=</span><span style="color:#ba2121">&#39;line&#39;</span>,   <span style="color:#408080;font-style:italic"># As a line plot</span>
    title<span style="color:#666">=</span><span style="color:#ba2121">&#39;Rolling Mood Level over Time (window = 28d)&#39;</span>,
    rot<span style="color:#666">=</span><span style="color:#666">90</span>,        <span style="color:#408080;font-style:italic"># Rotate the xlabels</span>
)

ax<span style="color:#666">.</span>set_xlabel(<span style="color:#ba2121">&#39;Central Date&#39;</span>)
ax<span style="color:#666">.</span>set_ylabel(<span style="color:#ba2121">&#39;Average Mood Level during Window&#39;</span>)
plt<span style="color:#666">.</span>tight_layout()</code></pre></div>
</div>
<pre class="example">
Text(42.597222222222214, 0.5, &#39;Average Mood Level during Window&#39;)
</pre>
<div class="src src-python">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#408080;font-style:italic"># Save the figure - don&#39;t worry about this part, this is for our use!</span>
PLOT_FILENAME <span style="color:#666">=</span> <span style="color:#ba2121">&#34;mood-diary-plot-rolling.png&#34;</span>
plt<span style="color:#666">.</span>savefig(PLOT_FILENAME)
PLOT_FILENAME</code></pre></div>
</div>
<p>
<img src="../mood-diary-plot-rolling.png" alt="../mood-diary-plot-rolling.png" title="../mood-diary-plot-rolling.png" />
</p>
<p>
With this, the cyclical nature of the graph is clear and he jump in mood level
is also made very apparent. We could choose different windows - for example, to
smooth out each cycle - but already, it should be very clear that Kennedy&#39;s mood
level pattern changed in approximately <strong>April 2021</strong>.
</p>
<p>
This has been quite a long discussion of how to get here - but once you get used
to it, this sort of task becomes very quick. We haven&#39;t used very complicated
means of processing the data, and were able to plot it almost directly once we&#39;d
processed the text.
</p>
</details>
<h3 id="headline-3">
Data Generation
</h3>
<details><summary>Click here to show the data generation code.</summary>
<blockquote>
<p>
This data was generated with the <a href="https://www.jsoftware.com/#/">J programming language</a>. J is a descendent of
the <a href="https://en.wikipedia.org/wiki/APL_(programming_language)">APL programming language family</a>, infamous for being terse and apparently
unreadable. APL and J make very heavy use of symbols to expose useful primitive
operations on arrays - similar in many ways to Matlab or Python&#39;s Numpy. Though
the symbolism may look like obfuscation, it&#39;s not intentional. One of the core
ideas of the APL family is about operating on collections of data as a whole
rather than using conditional or looping structures, and the notation is simply
a way to express these operations compactly.
</p>
<p>
If you are interested in the APL/J/K family of languages, then we are always
very happy to have a chat to explain more about them. K (similar to J) is
apparently used quite heavily in the financial industry - so even though the
languages may appear unreadable, they <em>are</em> used in real-life.
</p>
</blockquote>
<p>
First, we define the qualitative words and their groupings into mood levels.
</p>
<div class="src src-j">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-j" data-lang="j"><span style="color:#19177c">Level1</span> <span style="color:#666">=:</span> <span style="color:#ba2121">&#39;DEPRESSED&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;VERY LOW&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;HOPELESS&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;BLEAK&#39;</span>
<span style="color:#19177c">Level2</span> <span style="color:#666">=:</span> <span style="color:#ba2121">&#39;LOW&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;SAD&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;TEARY&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;FLAT&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;TIRED&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;STRESSED&#39;</span>
<span style="color:#19177c">Level3</span> <span style="color:#666">=:</span> <span style="color:#ba2121">&#39;SO-SO&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;OKAY&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;FINE&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;NOT BAD&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;SATISFIED&#39;</span>
<span style="color:#19177c">Level4</span> <span style="color:#666">=:</span> <span style="color:#ba2121">&#39;GOOD&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;REFRESHED&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;HAPPY&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;JOYFUL&#39;</span>
<span style="color:#19177c">Level5</span> <span style="color:#666">=:</span> <span style="color:#ba2121">&#39;ON TOP OF THE WORLD&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;ECSTATIC&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;ELATED&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;ELEVATED&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;AMAZING&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;BRILLIANT&#39;</span><span style="color:#666">;</span><span style="color:#ba2121">&#39;FANTASTIC&#39;</span>
<span style="color:#19177c">Levels</span> <span style="color:#666">=:</span> <span style="color:#19177c">Level1</span><span style="color:#666">;</span><span style="color:#19177c">Level2</span><span style="color:#666">;</span><span style="color:#19177c">Level3</span><span style="color:#666">;</span><span style="color:#19177c">Level4</span><span style="color:#666">;&lt;</span><span style="color:#19177c">Level5</span></code></pre></div>
</div>
<p>
Next, we define important dates for the data.
</p>
<div class="src src-j">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-j" data-lang="j"><span style="color:#19177c">StartDate</span> <span style="color:#666">=:</span> <span style="color:#666">2020</span> <span style="color:#666">1</span> <span style="color:#666">1</span>
<span style="color:#19177c">EndDate</span> <span style="color:#666">=:</span> <span style="color:#666">2022</span> <span style="color:#666">1</span> <span style="color:#666">1</span>
<span style="color:#19177c">ChangeDate</span> <span style="color:#666">=:</span> <span style="color:#666">2021</span> <span style="color:#666">4</span> <span style="color:#666">3</span></code></pre></div>
</div>
<p>
We will model the mood with a low-amplitude sine wave with random perturbations, then
round it to one of the five levels. We&#39;ll give the sine function a period of 4
weeks and an amplitude of 1.5, and translate it so that it averages around
Level2 (or index 1 of the <code class="verbatim">Levels</code> array). We&#39;ll also add some random noise as a
uniform distribution between -1 and 1, and make sure to keep it between 0 and 4.
</p>
<div class="src src-j">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-j" data-lang="j"><span style="color:#19177c">mood1</span> <span style="color:#666">=:</span> <span style="color:#19177c">dyad</span> <span style="color:#666">:</span><span style="color:#ba2121">&#39;&lt;.0&gt;.(1-~2*x)+1+1.5*1&amp;o.28%~o.y&#39;</span></code></pre></div>
</div>
<p>
After <code class="verbatim">ChangeDate</code>, we&#39;ll translate the the mood so it averages around Level 4
(index 3), with an amplitude of 0.8 and lower random noise.
</p>
<div class="src src-j">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-j" data-lang="j"><span style="color:#19177c">mood2</span> <span style="color:#666">=:</span> <span style="color:#19177c">dyad</span> <span style="color:#666">:</span><span style="color:#ba2121">&#39;&lt;.5&lt;.0&gt;.(0.5-~x)+3+0.8*1&amp;o.28%~o.y&#39;</span></code></pre></div>
</div>
<p>
We&#39;ll now create the numerical data.
</p>
<div class="src src-j">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-j" data-lang="j"><span style="color:#19177c">NumData1</span> <span style="color:#666">=:</span> (?<span style="color:#666">@:#&amp;</span><span style="color:#666">0</span> <span style="color:#19177c">mood1</span> <span style="color:#19177c">i</span><span style="color:#666">.</span>) <span style="color:#19177c">ChangeDate</span>(<span style="color:#19177c">todayno</span><span style="color:#666">@[-</span><span style="color:#19177c">todayno</span><span style="color:#666">@]</span>)<span style="color:#19177c">StartDate</span>
<span style="color:#19177c">NumData2</span> <span style="color:#666">=:</span> (?<span style="color:#666">@:#&amp;</span><span style="color:#666">0</span> <span style="color:#19177c">mood2</span> <span style="color:#19177c">i</span><span style="color:#666">.</span>) <span style="color:#19177c">EndDate</span>(<span style="color:#19177c">todayno</span><span style="color:#666">@[-</span><span style="color:#19177c">todayno</span><span style="color:#666">@]</span>)<span style="color:#19177c">ChangeDate</span>
<span style="color:#19177c">NumData</span> <span style="color:#666">=:</span> <span style="color:#19177c">NumData1</span><span style="color:#666">,</span><span style="color:#19177c">NumData2</span></code></pre></div>
</div>
<p>
Next, we define a function to index into levels using <code class="verbatim">NumData</code> and choose a
random word at the corresponding level.
</p>
<div class="src src-j">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-j" data-lang="j"><span style="color:#19177c">pick</span> <span style="color:#666">=:</span> <span style="color:#666">[:</span>(?<span style="color:#666">@#{]</span>)<span style="color:#666">&gt;@:{&amp;</span><span style="color:#19177c">Levels</span></code></pre></div>
</div>
<p>
We can then convert the numerical data into boxed descriptors.
</p>
<div class="src src-j">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-j" data-lang="j"><span style="color:#19177c">WordData</span> <span style="color:#666">=:</span> <span style="color:#666">;</span> <span style="color:#19177c">pick</span> <span style="color:#19177c">each</span> <span style="color:#19177c">NumData</span></code></pre></div>
</div>
<p>
And convert the dates to corresponding strings.
</p>
<div class="src src-j">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-j" data-lang="j"><span style="color:#19177c">Days</span> <span style="color:#666">=:</span> (<span style="color:#19177c">todayno</span> <span style="color:#19177c">StartDate</span>)<span style="color:#666">&amp;+</span> <span style="color:#19177c">i</span><span style="color:#666">.</span> <span style="color:#19177c">EndDate</span>(<span style="color:#19177c">todayno</span><span style="color:#666">@[-</span><span style="color:#19177c">todayno</span><span style="color:#666">@]</span>)<span style="color:#19177c">StartDate</span>
<span style="color:#19177c">pad</span> <span style="color:#666">=:</span> <span style="color:#666">4</span> <span style="color:#666">2</span> <span style="color:#666">2</span><span style="color:#666">&amp;</span>(((<span style="color:#666">[@</span>(<span style="color:#ba2121">&#39;0&#39;</span><span style="color:#666">#~[-#@]</span>)<span style="color:#666">,]</span>) <span style="color:#666">&#34;:@]</span>) <span style="color:#19177c">each</span>)
<span style="color:#19177c">Dates</span> <span style="color:#666">=:</span> (<span style="color:#19177c">pad</span><span style="color:#666">@</span><span style="color:#19177c">todate</span>) <span style="color:#19177c">each</span> <span style="color:#19177c">Days</span></code></pre></div>
</div>
<p>
Finally, we define a function to format the data.
</p>
<div class="src src-j">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-j" data-lang="j"><span style="color:#19177c">fmtword</span> <span style="color:#666">=:</span> (<span style="color:#ba2121">&#39;I feel &#39;</span><span style="color:#666">,</span><span style="color:#19177c">LF</span><span style="color:#666">,~</span><span style="color:#ba2121">&#39; today.&#39;</span><span style="color:#666">,~]</span>)
<span style="color:#19177c">fmtdate</span> <span style="color:#666">=:</span> <span style="color:#666">1</span><span style="color:#666">}.&amp;:;</span><span style="color:#ba2121">&#39;/&#39;</span><span style="color:#666">,</span><span style="color:#19177c">each</span><span style="color:#666">]</span>
<span style="color:#19177c">fmt</span> <span style="color:#666">=:</span> <span style="color:#19177c">dyad</span> <span style="color:#666">:</span><span style="color:#ba2121">&#39;(fmtdate x),&#39;&#39;    &#39;&#39;,(fmtword y)&#39;</span></code></pre></div>
</div>
<p>
We then format the data and save it.
</p>
<div class="src src-j">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-j" data-lang="j"><span style="color:#19177c">DataString</span> <span style="color:#666">=:</span> <span style="color:#666">;</span> <span style="color:#19177c">Dates</span> <span style="color:#19177c">fmt</span> <span style="color:#19177c">each</span> <span style="color:#19177c">WordData</span>
<span style="color:#19177c">DataString</span> <span style="color:#19177c">fwrite</span> <span style="color:#666">&lt;</span> <span style="color:#ba2121">&#39;input-mood-diary.txt&#39;</span></code></pre></div>
</div>
</details>

            </section>

        </article>
    </section>

    
    <footer>Contact us at <code> contact at cigmah dot org </code>.
</footer>
    

</section>


        </main>


    </body>
</html>
