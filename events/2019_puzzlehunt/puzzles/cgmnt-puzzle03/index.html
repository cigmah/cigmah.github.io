
<!DOCTYPE html>
<html><head>
    
    
    <title> CIGMAH - Combo Catcher </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="2019 Puzzle Hunt - Puzzle 03B">
    <meta name="theme-color" content="#000000" />
    <link rel="icon" href="https://cigmah.org/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cigmah.org/js/toggles.js"></script>
    <link type="text/css" rel="stylesheet" href=https://cigmah.org/sass/main.css>
    <link rel="canonical" href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle03/">
</head>
<body>
        <header>

            <nav id="nav-menu-toggle" onClick="toggleNav()">
                <div id="menu-text">☰</div>
                <div id="cigmah-brand">
                    <div id="cigmah-icon">
                        <img src="https://cigmah.org/img/cigmah-icon.png">
                    </div>
                    <div id="cigmah-text">
                        CIGMAH
                    </div>
                </div>
            </nav>

            <nav id="nav-bar">

<ul id="nav-link-list" onClick="()">

    <li
        class="nav-link-list-item "
    >
        <a
            class="nav-link-list-link "
            id="nav-cigmah-link"
            href=https://cigmah.org/
        >
            <img id="nav-cigmah-link-icon" src="/img/cigmah-icon-small.png">
            <div>CIGMAH</div>
        </a>
    </li>

  
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/about/
        >
            About
        </a>
    </li>
    
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/events/
        >
            Events
        </a>
    </li>
    
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/tools/
        >
            Tools
        </a>
    </li>
    
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/resources/
        >
            Resources
        </a>
    </li>
    
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/blog/
        >
            Blog
        </a>
    </li>
    
    <li
        class="nav-link-list-item "
        >
        <a
            class="nav-link-list-link "
            href=https://cigmah.org/contact/
        >
            Contact
        </a>
    </li>
    

    <li
        class="nav-link-list-item"
        id="nav-right-item"
        >
        <a
            href="https://aorta.cigmah.org"
            id="nav-aorta-link"
            class="nav-link-list-link"
        >
            <img id="nav-aorta-link-icon" src="/img/aorta-icon.png">
            <div id="nav-aorta-link">AORTA</div>
        </a>
    </li>
</ul>
</nav>

        </header>

        <main>



<section class="normal-page">
    <article id="side-navigation">
        <article id="toggle-side-navigation-container">

            
            <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle02/" id="back"> &lt;&lt; </a>
            

            <button id="toggle-side-navigation" onClick="toggleSideNav()">Show Articles</button>

            
            <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle04/" id="next"> &gt;&gt; </a>
            

        </article>

        <ul id="side-navigation-list">

            
            <li class="side-navigation-parent">
                <a href="https://cigmah.org/events/">Events</a>
            </li>
            


            <li class="side-navigation-section">
                <a href="https://cigmah.org/events/2019_puzzlehunt/">
                    2019 Puzzle Hunt
                </a>
            </li>

            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle01/">Lost in a Library</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle02/">Metabolic Mayhem</a>
            </li>
            
            <li
                class="side-navigation-item  active "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle03/">Combo Catcher</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle04/">Troubled Test</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle05/">Out of Sync</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle06/">While You&#39;re Waiting</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle07/">Infectious Network</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle08/">Tarsal Tumble</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle09/">Fundal Flow</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle10/">Bite Cell Scouting</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle11/">NeuroLogic</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle12/">Reschedule All</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle13/">Allele Inference</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle14/">Base in Balance</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle15/">Worst Offender</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle16/">STI Bugs&#39;n&#39;Drugs</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle17/">What Dipstick?</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle18/">Peak Flow Diary</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle19/">HPV Profiling</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle20/">Code Broadcast</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle21/">Genetic Thrift</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle22/">Neural Decoding</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle23/">Run! (Preclinical)</a>
            </li>
            
            <li
                class="side-navigation-item "
            >
                <a href="https://cigmah.org/events/2019_puzzlehunt/puzzles/cgmnt-puzzle24/">Run! (Clinical)</a>
            </li>
            

        </ul>

    </article>

    <section id="container">

        <article id="content">
            <header id="content-header">
            <h1 id="content-title"> Combo Catcher </h1>

            
                <div id="subtitle">
                    <div> 2019 Puzzle Hunt - Puzzle 03B </div>
                </div>
            

            </div>

            </header>

            <section id="content-body">
                <blockquote>
<p>This puzzle was released on 2019-02-23, and was the Beginner puzzle for the theme <em>Text Books (Sample)</em>.</p>
</blockquote>
<!-- raw HTML omitted -->
<p>It&rsquo;s 12:20am. Facing North, you walk through the corridor on the 6th wall.</p>
<p><img src="https://i.imgur.com/diXqpfu.gif" alt="Image"></p>
<p>Again, you step up to the center of the room and look at the book on the table.
The cover says <em>Unusual Effects of the Anti-Mycobacterial</em>. You open it up and
read the first page.</p>
<blockquote>
<p>We have discovered surprising and potentially useful effects of the
aforementioned anti-mycobacterial. Our previously bedridden patients have
experienced increased vitality and improved mood. Unfortunately, upon
introduction of the medication to our wards, we have noticed an unprecedented
increase of an unknown process manifesting as retinal haemorrhage, headache
and neurological weakness. We therefore urge the committee to pend usage of
this drug until further investigation.</p>
</blockquote>
<p>It sounds like part of a transmission. Unfortunately, it&rsquo;s very vague. You read
on.</p>
<blockquote>
<p>We have strong reason to believe that this is due to an interaction with an
existing medication. We do not know the identify of this medication, so to
help with our further exploration of this issue, we have attached records of
our last month of admissions and the presence of the interaction outcome. If
you could assist us with determining the identity of the existing medication
which causes this interaction, we would be very grateful.</p>
</blockquote>
<p>The next pages all appear to be deidentified clinical records of some sort. The
first page reads:</p>
<pre><code>PATIENT ID: 000000
DATE: 14/01/0001

CLINICAL BRIEF:
A 30 year old man employed as a shoe builder, previously diagnosed with osteoarthritis.
Presented with diarrhoea.

MEDICATIONS:
- Atropine sulfate monohydrate
- Iron
- Rituximab
- Valaciclovir
- Mupirocin
- Magnesium aspartate dihydrate
- Pyrazinamide
- Diclofenac
- Ethambutol
- Sapropterin
- Honey bee venom
- Iproniazid
- Trimethoprim
- Cabazitaxel

OUTCOME OF INTEREST:
Not present.

</code></pre><p>(You are bemused by the year <code>0001</code> and how these medications existed back then,
but much more disturbed by the completely nonsensical combination of medications
this patient is on. &ldquo;But,&rdquo; you reason to yourself, &ldquo;perhaps things were
different back then&hellip;&quot;).</p>
<p>The remaining pages are all in the same format.</p>
<p>You have a think. It seems like this transmission is referring to an interaction
between two medications (both unnamed) causing an outcome of interest. And it
looks like this transmission wanted the receiver to determine what these two
interacting medications were from the attached records.</p>
<h1 id="input">Input</h1>
<p><a href="https://drive.google.com/open?id=1K1PJ3XbyfL9p0gMvfXxr0bhJCBeS_Kj2">cgmnt_input03.txt</a> (446Kb)</p>
<h1 id="statement">Statement</h1>
<p>State the name of the anti-mycobacterial first, then the interacting drug. (e.g. <code>RIFAMPIN CULPRITASE</code>).</p>
<h1 id="references">References</h1>
<p>Written by the CIGMAH Puzzle Hunt 2019 team. \</p>
<p>Here was a reference we found useful for making this puzzle:</p>
<p>Phansalkar, S., Desai, A., Bell, D., Yoshida, E., Doole, J., Czochanski, M., Middleton, B. and Bates, D. (2012). High-priority drug–drug interactions for use in electronic health records. Journal of the American Medical Informatics Association, 19(5), pp.735-743.</p>
<hr>
<h1 id="answer">Answer</h1>
<p>The correct solution was <code>Iproniazid Amfepramone</code>.</p>
<h1 id="explanation">Explanation</h1>
<h2 id="map-hint">Map Hint</h2>
<p>You feel gratified for having found the right answer and marvel at how far modern medicine has come since the year <code>0001</code>. To think, combining a stimulant with a MAO inhibitor! Not to mention all the other wacky combinations this hospital used&hellip;</p>
<p>You open <code>map_hint.txt</code>. It has only one line:</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">The Map of the Medical Library of Babel is an HTML file.
</code></pre></div><p>Hm. You wonder, how could there be a HTML file in that random collection of letters?</p>
<h2 id="writers-notes">Writer&rsquo;s Notes</h2>
<h3 id="objectives">Objectives</h3>
<p>Our objectives for this puzzle were to incorporate:</p>
<ol>
<li>Basic text processing</li>
<li>Basic set theory</li>
<li>Basic data structures</li>
</ol>
<p>When planning the puzzle, we intended the solving steps to be to:</p>
<ol>
<li>Extract medications and the outcome for each patient</li>
<li>Perform set operations to determine the common combination</li>
<li>Correctly interpret the medications (i.e. put the anti-mycobacterial first)</li>
</ol>
<p>Because the objectives were based around basic text processing, we didn&rsquo;t strive for realism for the generated medication lists (or clinical briefs for that matter). We reasoned that the principles would be the same as long as the format of the input was similar, even if the actual content was nonsense.</p>
<h3 id="context">Context</h3>
<p>Drug interactions are a vital consideration when prescribing, modifying prescriptions and evaluating symptoms. Many systems for automatically detecting drug interactions are available in various EMR software - although some clinicians might contest the usefulness of these alerts, it is one prominent example where software can assist in &ldquo;catching&rdquo; or flagging potential errors.</p>
<p>We brainstormed potential ways of having participants emulate such a system. We eventually settled on a small problem involving some basic set operations to discover an interaction between two unknown drugs. While this puzzle is, of course, heavily simplified, we hoped that the simplification would make the puzzle accessible for beginners.</p>
<h3 id="example-solution">Example Solution</h3>
<blockquote>
<p>Our example solutions are just one way of solving the puzzle. They&rsquo;re not necessarily the best way, or even a good way!</p>
</blockquote>
<p>Loading the data:</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">requests</span>

input_url <span style="color:#666">=</span> <span style="color:#ba2121">&#34;https://drive.google.com/uc?id=1K1PJ3XbyfL9p0gMvfXxr0bhJCBeS_Kj2&#34;</span>
text <span style="color:#666">=</span> requests<span style="color:#666">.</span>get(input_url)<span style="color:#666">.</span>text
</code></pre></div><p>Processing the data:</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">re</span>

positive_regex <span style="color:#666">=</span> re<span style="color:#666">.</span>compile(<span style="color:#ba2121">r</span><span style="color:#ba2121">&#39;MEDICATIONS:\n((?:-\s.*?\n?)*)\n\nOUTCOME OF INTEREST:\nPresent&#39;</span>)
medications <span style="color:#666">=</span> [<span style="color:#008000">set</span>(record<span style="color:#666">.</span>lstrip(<span style="color:#ba2121">&#39;- &#39;</span>)<span style="color:#666">.</span>split(<span style="color:#ba2121">&#39;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">- &#39;</span>)) <span style="color:#008000;font-weight:bold">for</span> record <span style="color:#a2f;font-weight:bold">in</span> positive_regex<span style="color:#666">.</span>findall(text)]
<span style="color:#008000">set</span><span style="color:#666">.</span>intersection(<span style="color:#666">*</span>medications)
</code></pre></div><pre><code>{'Amfepramone', 'Iproniazid'}
</code></pre>
<blockquote>
<p>Note - for the actual solution, this needs to be submitted as &ldquo;Iproniazid Amfepramone&rdquo; as the solution specifies that the anti-mycobacterial should be written first!</p>
</blockquote>
<p>The three lines of this solution do the following:</p>
<ol>
<li>Extract the medications block from every patient record which had a positive outcome.</li>
<li>Make a Python <code>set</code> of medications for each medication block that was extracted.</li>
<li>Find the intersection of all the sets (which should give only the medications that <em>all</em> patients who had the outcome were taking)</li>
</ol>
<p>This gave only two medications, so we could stop there - if there were more, we would have had to check which combination also occurred in patients who didn&rsquo;t have the outcome.</p>
<h3 id="data-generation">Data Generation</h3>
<p>We chose two drug classes based on <a href="https://dx.doi.org/10.1136%2Famiajnl-2011-000612">an article on high-priority drug interactions for EMR systems</a> by Phansalkar et al. 2012, settling on the interaction between stimulants and MAO inhibitors. We also <a href="https://www.ncbi.nlm.nih.gov/pubmed/23231399">read up on the history</a> of MAO inhibitors to help give the scenario some meaningful context and used its origins as an anti-mycobacterial to provide one of the clues.</p>
<p>To help prevent against shrewd medical students correctly guessing the drugs from the scenario text (though perhaps they should have been rewarded!), we chose <strong>amfepramone</strong> as the answer, a drug that was less likely to be known by medical students than those such as methylphenidate or atomoxetine. We chose <strong>iproniazid</strong> given its importance in the history of MAO inhibitors, and mixed in other antimycobacterials (such as rifampin and isoniazid) to prevent easy guessing from inspecting the records. We also made the medication lists quite long (minimum 12 medications), again to prevent inspection being an easy way out (even if this was unrealistic).</p>
<p>To generate the data, we began by specifying a template for the format of the patient records. It was unnecessary for our purposes to use any sophisticated language processing for this puzzle, so we made it a straight substitution template.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">template <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;&#34;
</span><span style="color:#ba2121">PATIENT ID: {patient_id}
</span><span style="color:#ba2121">DATE: {date}
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">CLINICAL BRIEF:
</span><span style="color:#ba2121">A {age} year old {person} employed as a {object} {job}, previously {health}.
</span><span style="color:#ba2121">Presented with {presentation}.
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">MEDICATIONS:
</span><span style="color:#ba2121">{medications}
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">OUTCOME OF INTEREST:
</span><span style="color:#ba2121">{outcome}
</span><span style="color:#ba2121">&#34;&#34;&#34;</span>
</code></pre></div><p>We then specified some generation functions for each variable. You will notice they are quite limited - we didn&rsquo;t feel the need to spend much time on this part given that the information was not necessary for the puzzle objectives.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">random</span>

answer <span style="color:#666">=</span> <span style="color:#ba2121">&#34;Amfepramone&#34;</span>
introduced <span style="color:#666">=</span> <span style="color:#ba2121">&#34;Iproniazid&#34;</span>

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_patient_id</span>(index):
    <span style="color:#008000;font-weight:bold">return</span> <span style="color:#ba2121">&#34;{0:06d}&#34;</span><span style="color:#666">.</span>format(index)

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_date</span>():
    day <span style="color:#666">=</span> (random<span style="color:#666">.</span>randint(<span style="color:#666">1</span>, <span style="color:#666">31</span>))
    <span style="color:#008000;font-weight:bold">return</span> <span style="color:#ba2121">&#34;{0:02d}/01/0001&#34;</span><span style="color:#666">.</span>format(day)

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_age</span>():
    <span style="color:#008000;font-weight:bold">return</span> random<span style="color:#666">.</span>randint(<span style="color:#666">20</span>, <span style="color:#666">80</span>)

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_person</span>():
    choices <span style="color:#666">=</span> [<span style="color:#ba2121">&#34;man&#34;</span>,
             <span style="color:#ba2121">&#34;woman&#34;</span>,
             <span style="color:#ba2121">&#34;gentleman&#34;</span>,
             <span style="color:#ba2121">&#34;lady&#34;</span>,
             <span style="color:#ba2121">&#34;sir&#34;</span>,
             <span style="color:#ba2121">&#34;madam&#34;</span>]
    <span style="color:#008000;font-weight:bold">return</span> random<span style="color:#666">.</span>choice(choices)

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_object</span>():
    choices <span style="color:#666">=</span> [<span style="color:#ba2121">&#34;violone&#34;</span>,
             <span style="color:#ba2121">&#34;pyramid&#34;</span>,
             <span style="color:#ba2121">&#34;throne&#34;</span>,
             <span style="color:#ba2121">&#34;sarcophagus&#34;</span>,
             <span style="color:#ba2121">&#34;chimney&#34;</span>,
             <span style="color:#ba2121">&#34;carriage&#34;</span>,
             <span style="color:#ba2121">&#34;pickaxe&#34;</span>,
             <span style="color:#ba2121">&#34;shoe&#34;</span>]
    <span style="color:#008000;font-weight:bold">return</span> random<span style="color:#666">.</span>choice(choices)

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_job</span>():
    choices <span style="color:#666">=</span> [<span style="color:#ba2121">&#34;builder&#34;</span>,
             <span style="color:#ba2121">&#34;shiner&#34;</span>,
             <span style="color:#ba2121">&#34;mender&#34;</span>,
             <span style="color:#ba2121">&#34;seller&#34;</span>,
             <span style="color:#ba2121">&#34;sweeper&#34;</span>,
             <span style="color:#ba2121">&#34;painter&#34;</span>,
             <span style="color:#ba2121">&#34;holder&#34;</span>,
             <span style="color:#ba2121">&#34;mover&#34;</span>]
    <span style="color:#008000;font-weight:bold">return</span> random<span style="color:#666">.</span>choice(choices)

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_health</span>():
    diagnoses <span style="color:#666">=</span> [<span style="color:#ba2121">&#34;rickets&#34;</span>,
               <span style="color:#ba2121">&#34;an unknown infection&#34;</span>,
               <span style="color:#ba2121">&#34;hypertension&#34;</span>,
               <span style="color:#ba2121">&#34;hyperlipidaemia&#34;</span>,
               <span style="color:#ba2121">&#34;gastroenteritis&#34;</span>,
               <span style="color:#ba2121">&#34;osteoarthritis&#34;</span>,
               <span style="color:#ba2121">&#34;an unknown chronic cough&#34;</span> ]

    diagnosis_strings <span style="color:#666">=</span> [<span style="color:#ba2121">&#34;diagnosed with {}&#34;</span><span style="color:#666">.</span>format(diagnosis)
                       <span style="color:#008000;font-weight:bold">for</span> diagnosis <span style="color:#a2f;font-weight:bold">in</span> diagnoses]

    choices <span style="color:#666">=</span> [<span style="color:#ba2121">&#34;healthy&#34;</span>] <span style="color:#666">+</span> diagnosis_strings

    <span style="color:#008000;font-weight:bold">return</span> random<span style="color:#666">.</span>choice(choices)

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_presentation</span>():
    choices <span style="color:#666">=</span> [<span style="color:#ba2121">&#34;cough&#34;</span>,
             <span style="color:#ba2121">&#34;wheeze&#34;</span>,
             <span style="color:#ba2121">&#34;fever&#34;</span>, <span style="color:#ba2121">&#34;dyspnoea&#34;</span>,
             <span style="color:#ba2121">&#34;chest pain&#34;</span>,
             <span style="color:#ba2121">&#34;a fracture&#34;</span>,
             <span style="color:#ba2121">&#34;haemoptysis&#34;</span>,
             <span style="color:#ba2121">&#34;diarrhoea&#34;</span>,
             <span style="color:#ba2121">&#34;joint pain&#34;</span>,
             <span style="color:#ba2121">&#34;a rash&#34;</span>]
    <span style="color:#008000;font-weight:bold">return</span> random<span style="color:#666">.</span>choice(choices)

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_outcome</span>(has_outcome):
    <span style="color:#008000;font-weight:bold">if</span> has_outcome:
        <span style="color:#008000;font-weight:bold">return</span> <span style="color:#ba2121">&#34;Present.&#34;</span>
    <span style="color:#008000;font-weight:bold">else</span>:
        <span style="color:#008000;font-weight:bold">return</span> <span style="color:#ba2121">&#34;Not present.&#34;</span>
</code></pre></div><p>To get a comprehensive list of medications, we scraped data (once only) from the <a href="https://www.pbs.gov.au/browse/medicine-listing">PBS Medicine Listing</a>.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">requests</span>
<span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">urllib.parse</span> <span style="color:#008000;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">parse</span>
<span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">string</span>

url_base <span style="color:#666">=</span> <span style="color:#ba2121">&#34;https://www.pbs.gov.au/browse/medicine-listing?&#34;</span>
queries  <span style="color:#666">=</span> [{<span style="color:#ba2121">&#34;initial&#34;</span>: char} <span style="color:#008000;font-weight:bold">for</span> char <span style="color:#a2f;font-weight:bold">in</span> string<span style="color:#666">.</span>ascii_lowercase]
urls     <span style="color:#666">=</span> [url_base <span style="color:#666">+</span> parse<span style="color:#666">.</span>urlencode(query) <span style="color:#008000;font-weight:bold">for</span> query <span style="color:#a2f;font-weight:bold">in</span> queries]
data     <span style="color:#666">=</span> [requests<span style="color:#666">.</span>get(url)<span style="color:#666">.</span>text <span style="color:#008000;font-weight:bold">for</span> url <span style="color:#a2f;font-weight:bold">in</span> urls]
</code></pre></div><p>Upon inspection of the HTML of the PBS Medicine Listing page, the drug names are included in table cells (``) within the <code>title</code> attribute.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">re</span>

<span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_meds</span>(string):
    matches <span style="color:#666">=</span> re<span style="color:#666">.</span>findall(<span style="color:#ba2121">r</span><span style="color:#ba2121">&#39;&lt;td class=&#34;cell_drug&#34;&gt;.*?title=&#34;([\w\s]+)&#34;&#39;</span>, string)
    <span style="color:#008000;font-weight:bold">return</span> matches
</code></pre></div><p>We wanted to release this sample puzzle early, so we only did a very cursory (and ugly) removal of other stimulants and MAO inhibitors on the resulting set - to remove them more thoroughly would have been nice.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">exclusion_text <span style="color:#666">=</span> <span style="color:#ba2121">&#34;&#34;&#34;
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Dexmethylphenidate
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Dextroamphetamine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Methylphenidate
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Lisdexamefetamine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Methamphetamine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Phendimetrazine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Pseudoephedrine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Amphetamine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Benzphetamine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Diethylpropion
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Phentermine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Atomoxetine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Tranylcypromine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Phenelzine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Isocarboxazid
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Procarbazine
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Selegiline
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Iproniazid
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">   Amfepramone
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">
</span><span style="color:#ba2121">&#34;&#34;&#34;</span>

exclusions <span style="color:#666">=</span> re<span style="color:#666">.</span>findall(<span style="color:#ba2121">r</span><span style="color:#ba2121">&#39;\w+&#39;</span>, exclusion_text)
</code></pre></div><div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">meds <span style="color:#666">=</span> [med<span style="color:#666">.</span>capitalize()
        <span style="color:#008000;font-weight:bold">for</span> page <span style="color:#a2f;font-weight:bold">in</span> data
        <span style="color:#008000;font-weight:bold">for</span> med <span style="color:#a2f;font-weight:bold">in</span> get_meds(page)
        <span style="color:#008000;font-weight:bold">if</span> <span style="color:#a2f;font-weight:bold">not</span> <span style="color:#008000">any</span>([exclusion<span style="color:#666">.</span>lower() <span style="color:#a2f;font-weight:bold">in</span> med<span style="color:#666">.</span>lower() <span style="color:#008000;font-weight:bold">for</span> exclusion <span style="color:#a2f;font-weight:bold">in</span> exclusions])
       ]
</code></pre></div><div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000">len</span>(meds)
</code></pre></div><pre><code>1050
</code></pre>
<p>It struck us that having a large list of medications meant that it would be easy to manually inspect two records with the &ldquo;Present&rdquo; outcome and find the intersection without needing to use any programming. We therefore decided to limit the set to 16 medications, and ensured there was more than one anti-mycobacterial drug.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">meds <span style="color:#666">=</span> random<span style="color:#666">.</span>sample(meds, k<span style="color:#666">=</span><span style="color:#666">14</span>) <span style="color:#666">+</span> [<span style="color:#ba2121">&#34;Ethambutol&#34;</span>, <span style="color:#ba2121">&#34;Pyrazinamide&#34;</span>]
</code></pre></div><p>We can then write a function to get medicaitons.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_medications</span>(has_outcome):
    number <span style="color:#666">=</span> random<span style="color:#666">.</span>randint(<span style="color:#666">12</span>, <span style="color:#666">16</span>)
    sample <span style="color:#666">=</span> random<span style="color:#666">.</span>sample(meds, k<span style="color:#666">=</span>number)
    <span style="color:#008000;font-weight:bold">if</span> has_outcome:
        medications <span style="color:#666">=</span> [answer, introduced] <span style="color:#666">+</span> sample
        random<span style="color:#666">.</span>shuffle(medications)
    <span style="color:#008000;font-weight:bold">else</span>:
        <span style="color:#408080;font-style:italic"># Sometimes choose only ONE of the answer/introduced medication</span>
        maybe_other <span style="color:#666">=</span> random<span style="color:#666">.</span>choices([answer, introduced, None],
                                     [<span style="color:#666">0.40</span>, <span style="color:#666">0.40</span>, <span style="color:#666">0.20</span>],
                                     k<span style="color:#666">=</span><span style="color:#666">1</span>)
        medications <span style="color:#666">=</span> sample
        <span style="color:#008000;font-weight:bold">if</span> maybe_other[<span style="color:#666">0</span>] <span style="color:#a2f;font-weight:bold">is</span> <span style="color:#a2f;font-weight:bold">not</span> None:
            medications <span style="color:#666">+=</span> maybe_other
            random<span style="color:#666">.</span>shuffle(medications)
    med_string <span style="color:#666">=</span> <span style="color:#ba2121">&#34;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">&#34;</span><span style="color:#666">.</span>join([<span style="color:#ba2121">&#34;- {}&#34;</span><span style="color:#666">.</span>format(med) <span style="color:#008000;font-weight:bold">for</span> med <span style="color:#a2f;font-weight:bold">in</span> medications])
    <span style="color:#008000;font-weight:bold">return</span> med_string
</code></pre></div><p>We now have all the <code>get</code> functions we need. Let&rsquo;s make a patient record generator.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">get_patient</span>(index, has_outcome):
    record <span style="color:#666">=</span> template<span style="color:#666">.</span>format(patient_id<span style="color:#666">=</span>get_patient_id(index),
                           date<span style="color:#666">=</span>get_date(),
                           age<span style="color:#666">=</span>get_age(),
                           person<span style="color:#666">=</span>get_person(),
                           <span style="color:#008000">object</span><span style="color:#666">=</span>get_object(),
                           job<span style="color:#666">=</span>get_job(),
                           health<span style="color:#666">=</span>get_health(),
                           presentation<span style="color:#666">=</span>get_presentation(),
                           medications<span style="color:#666">=</span>get_medications(has_outcome),
                           outcome<span style="color:#666">=</span>get_outcome(has_outcome)
                          )
    <span style="color:#008000;font-weight:bold">return</span> record
</code></pre></div><p>Now, let&rsquo;s generate patient records. We&rsquo;ll make the number large (1000), and the percentage of patients with the outcome relatively small (about 100 or so).</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">def</span> <span style="color:#00f">allocate_outcomes</span>(number):
    <span style="color:#008000;font-weight:bold">return</span> random<span style="color:#666">.</span>choices([True, False], [<span style="color:#666">0.1</span>, <span style="color:#666">0.9</span>], k<span style="color:#666">=</span>number)
</code></pre></div><div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">records <span style="color:#666">=</span> [get_patient(i, outcome)
           <span style="color:#008000;font-weight:bold">for</span> (i, outcome) <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#008000">zip</span>(<span style="color:#008000">range</span>(<span style="color:#666">1000</span>), allocate_outcomes(<span style="color:#666">1000</span>))]
</code></pre></div><p>We can now write to a file and save it as the input.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">text <span style="color:#666">=</span> <span style="color:#ba2121">&#34;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">---</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">&#34;</span><span style="color:#666">.</span>join(records)
filename <span style="color:#666">=</span> <span style="color:#ba2121">&#39;cgmnt_input03.txt&#39;</span>

<span style="color:#008000;font-weight:bold">with</span> <span style="color:#008000">open</span>(filename, <span style="color:#ba2121">&#39;w&#39;</span>) <span style="color:#008000;font-weight:bold">as</span> f:
    f<span style="color:#666">.</span>write(text)
</code></pre></div><p>At this point, we verified that indeed the only two shared medications were Amfepramone and Iproniazid.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">positive_regex <span style="color:#666">=</span> re<span style="color:#666">.</span>compile(<span style="color:#ba2121">r</span><span style="color:#ba2121">&#39;MEDICATIONS:\n((?:-\s.*?\n?)*)\n\nOUTCOME OF INTEREST:\nPresent&#39;</span>)
medications <span style="color:#666">=</span> [<span style="color:#008000">set</span>(record<span style="color:#666">.</span>lstrip(<span style="color:#ba2121">&#39;- &#39;</span>)<span style="color:#666">.</span>split(<span style="color:#ba2121">&#39;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">- &#39;</span>)) <span style="color:#008000;font-weight:bold">for</span> record <span style="color:#a2f;font-weight:bold">in</span> positive_regex<span style="color:#666">.</span>findall(text)]
<span style="color:#008000">set</span><span style="color:#666">.</span>intersection(<span style="color:#666">*</span>medications)
</code></pre></div><pre><code>{'Amfepramone', 'Iproniazid'}
</code></pre>

            </section>

        </article>
    </section>

    
    <footer>Contact us at <code> contact at cigmah dot org </code>.
</footer>
    

</section>


        </main>


    </body>
</html>
